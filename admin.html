<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <title>Admin - ABD PLAYER</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script>
        // Initialiser le thÃ¨me immÃ©diatement pour Ã©viter le flash
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
    <script>
        function hideLoadingMessage() {
            const loadingMsg = document.getElementById('loadingMessage');
            if (loadingMsg) loadingMsg.style.display = 'none';
        }
        window.hideLoadingMessage = hideLoadingMessage;
        
        let checkInterval = setInterval(function() {
            if (typeof requireAuth !== 'undefined') {
                clearInterval(checkInterval);
            }
        }, 100);
        
        setTimeout(function() {
            clearInterval(checkInterval);
            if (typeof requireAuth === 'undefined') {
                const loadingMsg = document.getElementById('loadingMessage');
                if (loadingMsg) {
                    loadingMsg.innerHTML = '<div style="font-size: 24px;">âŒ Erreur de chargement</div><div style="font-size: 14px; color: #888; margin-top: 10px;">Les fichiers chiffrÃ©s n\'ont pas pu Ãªtre chargÃ©s.<br><br><a href="index.html" style="color: #4a9eff; text-decoration: underline;">Retour Ã  l\'accueil</a></div>';
                }
            }
        }, 15000);
    </script>
</head>
<body>
    <div id="loadingMessage" style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #0a0a0a; color: #fff; font-family: 'Poppins', sans-serif; flex-direction: column; gap: 20px;">
        <div style="font-size: 24px;">ğŸ” VÃ©rification...</div>
    </div>
    
    <!-- Notification popup pour nouvelles visites -->
    <div id="visitNotification" class="visit-notification" style="display: none;">
        <div class="visit-notification-content">
            <div class="visit-notification-icon">ğŸ‘¤</div>
            <div class="visit-notification-text">
                <strong>Nouveau visiteur !</strong>
                <span id="visitNotificationTime"></span>
            </div>
            <button class="visit-notification-close" onclick="closeVisitNotification()">Ã—</button>
        </div>
    </div>
    
    <div class="app-container" style="display: none;">
        <header class="admin-header">
            <div class="header-wrapper">
                <h1 class="logo">âš™ï¸ Administration</h1>
                <div class="header-actions">
                    <button id="themeToggle" class="theme-toggle" aria-label="Changer de thÃ¨me">
                        <span class="theme-icon">ğŸŒ™</span>
                    </button>
                    <a href="index.html" class="btn btn-outline">ğŸ  Accueil</a>
                    <button onclick="logout()" class="btn btn-danger">ğŸšª DÃ©connexion</button>
                </div>
            </div>
        </header>

        <main class="admin-content">
            <section class="admin-panel stats-panel">
                <h2>ğŸ“Š Statistiques en Temps RÃ©el</h2>
                
                <!-- Cartes de statistiques principales -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ‘¥</div>
                        <div class="stat-content">
                            <div class="stat-label">Visiteurs InstantanÃ©s</div>
                            <div class="stat-value" id="activeVisitors">0</div>
                            <div class="stat-description">Actifs (5 derniÃ¨res min)</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“…</div>
                        <div class="stat-content">
                            <div class="stat-label">Visiteurs Aujourd'hui</div>
                            <div class="stat-value" id="todayVisitors">0</div>
                            <div class="stat-description">Visites uniques</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ–±ï¸</div>
                        <div class="stat-content">
                            <div class="stat-label">Clics Aujourd'hui</div>
                            <div class="stat-value" id="todayClicks">0</div>
                            <div class="stat-description">Sur les liens Telegram</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“ˆ</div>
                        <div class="stat-content">
                            <div class="stat-label">Total des Clics</div>
                            <div class="stat-value" id="totalClicks">0</div>
                            <div class="stat-description">Depuis le dÃ©but</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">â±ï¸</div>
                        <div class="stat-content">
                            <div class="stat-label">Clics cette Heure</div>
                            <div class="stat-value" id="thisHourClicks">0</div>
                            <div class="stat-description">DerniÃ¨re heure</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div class="stat-content">
                            <div class="stat-label">Taux de Conversion</div>
                            <div class="stat-value" id="conversionRate">0%</div>
                            <div class="stat-description">Visites â†’ Clics</div>
                        </div>
                    </div>
                </div>

                <!-- Graphiques -->
                <div class="charts-container">
                    <div class="chart-wrapper">
                        <h3>ğŸ“ˆ Ã‰volution des Visites (24h)</h3>
                        <canvas id="visitsChart"></canvas>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h3>ğŸ–±ï¸ Ã‰volution des Clics (24h)</h3>
                        <canvas id="clicksChart"></canvas>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h3>ğŸ† Top 10 Streams les Plus CliquÃ©s</h3>
                        <canvas id="topStreamsChart"></canvas>
                    </div>
                    
                    <div class="chart-wrapper">
                        <h3>ğŸ“… Visiteurs par Jour (7 derniers jours)</h3>
                        <canvas id="dailyVisitsChart"></canvas>
                    </div>
                </div>

                <!-- Statistiques dÃ©taillÃ©es -->
                <div class="detailed-stats">
                    <h3>ğŸ“‹ Statistiques DÃ©taillÃ©es</h3>
                    <div class="detailed-stats-grid">
                        <div class="detailed-stat-card">
                            <h4>â° Clics par Heure (Aujourd'hui)</h4>
                            <div id="clicksByHour" class="hourly-stats"></div>
                        </div>
                        <div class="detailed-stat-card">
                            <h4>ğŸ“Š Top 5 Streams</h4>
                            <div id="topStreamsList" class="top-streams-list"></div>
                        </div>
                    </div>
                </div>

                <div class="stats-update-info">
                    <span class="update-indicator" id="updateIndicator">ğŸŸ¢</span>
                    <span id="lastUpdate">Mise Ã  jour en cours...</span>
                </div>
            </section>

            <section class="admin-panel">
                <h2>â• Ajouter un Stream</h2>
                <form id="streamForm" class="stream-form">
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>ğŸ–¼ï¸ Image du Stream</label>
                            <div class="image-upload-box" id="imageUploadBox">
                                <input type="file" id="streamImage" accept="image/*" class="image-input-hidden">
                                <div class="image-preview-wrapper">
                                    <img id="imagePreview" src="" alt="Preview" style="display: none;">
                                    <div class="image-placeholder" id="imagePlaceholder">
                                        <span class="upload-icon">ğŸ“·</span>
                                        <span class="upload-text">Cliquez pour ajouter une image</span>
                                        <span class="upload-hint">JPG, PNG (max 5MB)</span>
                                    </div>
                                </div>
                                <button type="button" class="btn-remove" id="removeImageBtn" style="display: none;">âŒ Supprimer</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="streamName">ğŸ“º Nom du Stream</label>
                            <input type="text" id="streamName" placeholder="Ex: PSG vs Marseille" required>
                            <div id="streamNameError" class="error-message" style="display: none;"></div>
                        </div>
                        <div class="form-group">
                            <label for="streamLink">ğŸ”— Lien Telegram</label>
                            <input type="url" id="streamLink" placeholder="https://t.me/..." required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="streamDate">ğŸ“… Date</label>
                            <input type="date" id="streamDate" required>
                        </div>
                        <div class="form-group">
                            <label for="streamTime">ğŸ• Heure</label>
                            <input type="time" id="streamTime" required>
                        </div>
                        <div class="form-group">
                            <label for="streamCompetition">ğŸ† CompÃ©tition</label>
                            <input type="text" id="streamCompetition" placeholder="Ligue 1, Champions League..." required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="streamStatus">ğŸ“Š Statut</label>
                            <select id="streamStatus" required>
                                <option value="active">ğŸŸ¢ Actif</option>
                                <option value="dead">ğŸ”´ Mort</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-large">
                        âœ… Ajouter le Stream
                    </button>
                </form>
            </section>

            <section class="admin-panel">
                <h2>ğŸ“¢ Messages aux Visiteurs</h2>
                <form id="messageForm" class="stream-form">
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label for="messageText">ğŸ’¬ Message</label>
                            <textarea id="messageText" rows="3" placeholder="Entrez votre message important Ã  afficher aux visiteurs..." required></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="messageType">ğŸ¨ Type de message</label>
                            <select id="messageType">
                                <option value="info">â„¹ï¸ Information</option>
                                <option value="success">âœ… SuccÃ¨s</option>
                                <option value="warning">âš ï¸ Avertissement</option>
                                <option value="error">âŒ Erreur</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="messageActive" checked>
                                Message actif (affichÃ© aux visiteurs)
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">ğŸ“¤ Envoyer le Message</button>
                </form>
                <div id="messagesList" class="messages-list" style="margin-top: 24px;"></div>
            </section>

            <section class="admin-panel">
                <h2>ğŸŒ Liens Sociaux</h2>
                <form id="socialForm" class="stream-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="discordUrl">ğŸ’¬ Discord</label>
                            <input type="url" id="discordUrl" placeholder="https://discord.gg/...">
                        </div>
                        <div class="form-group">
                            <label for="xUrl">ğ• Twitter</label>
                            <input type="url" id="xUrl" placeholder="https://x.com/...">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Sauvegarder</button>
                </form>
            </section>

            <section class="admin-panel">
                <div class="section-title-bar">
                    <h2>ğŸ“‹ Streams Existants</h2>
                    <div class="filter-tabs">
                        <button class="tab-btn active" data-filter="all">Tous</button>
                        <button class="tab-btn" data-filter="active">Actifs</button>
                        <button class="tab-btn" data-filter="dead">Morts</button>
                    </div>
                </div>
                <div id="adminStreamsList" class="streams-grid"></div>
                <div id="adminEmptyState" class="empty-state">
                    <div class="empty-icon">ğŸ“‹</div>
                    <h3>Aucun stream</h3>
                </div>
            </section>
        </main>

        <footer class="app-footer">
            <div class="footer-content">
                <p>&copy; 2024 ABD PLAYER. Tous droits rÃ©servÃ©s.</p>
                <div class="footer-links">
                    <a href="index.html">Accueil</a>
                    <span>â€¢</span>
                    <a href="legal.html">Mentions LÃ©gales</a>
                    <span>â€¢</span>
                    <a href="legal.html#dmca">DMCA</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal d'Ã©dition -->
    <div id="editModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âœï¸ Modifier le Stream</h2>
                <button onclick="closeEditModal()" class="modal-close">&times;</button>
            </div>
            <form id="editStreamForm" class="stream-form">
                <div class="form-row">
                    <div class="form-group full-width">
                        <label>ğŸ–¼ï¸ Image du Stream</label>
                        <div class="image-upload-box">
                            <input type="file" id="editStreamImage" accept="image/*" class="image-input-hidden">
                            <div class="image-preview-wrapper edit-image-preview-wrapper">
                                <img id="editImagePreview" src="" alt="Preview" style="display: none;">
                                <div class="image-placeholder" id="editImagePlaceholder">
                                    <span class="upload-icon">ğŸ“·</span>
                                    <span class="upload-text">Cliquez pour changer l'image</span>
                                    <span class="upload-hint">JPG, PNG (max 5MB)</span>
                                </div>
                            </div>
                            <button type="button" class="btn-remove" id="editRemoveImageBtn" style="display: none;">âŒ Supprimer</button>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editStreamName">ğŸ“º Nom du Stream</label>
                        <input type="text" id="editStreamName" placeholder="Ex: PSG vs Marseille" required>
                    </div>
                    <div class="form-group">
                        <label for="editStreamLink">ğŸ”— Lien Telegram</label>
                        <input type="url" id="editStreamLink" placeholder="https://t.me/..." required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editStreamDate">ğŸ“… Date</label>
                        <input type="date" id="editStreamDate" required>
                    </div>
                    <div class="form-group">
                        <label for="editStreamTime">ğŸ• Heure</label>
                        <input type="time" id="editStreamTime" required>
                    </div>
                    <div class="form-group">
                        <label for="editStreamCompetition">ğŸ† CompÃ©tition</label>
                        <input type="text" id="editStreamCompetition" placeholder="Ligue 1, Champions League..." required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="editStreamStatus">ğŸ“Š Statut</label>
                        <select id="editStreamStatus" required>
                            <option value="active">ğŸŸ¢ Actif</option>
                            <option value="dead">ğŸ”´ Mort</option>
                        </select>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" onclick="closeEditModal()" class="btn btn-outline">âŒ Annuler</button>
                    <button type="submit" class="btn btn-primary">âœ… Sauvegarder</button>
                </div>
            </form>
        </div>
    </div>

    <script src="loader.js"></script>
    <script src="firebase-storage.js"></script>
    <script data-enc="config.js.enc.js"></script>
    <script data-enc="protection.js.enc.js"></script>
    <script data-enc="auth.js.enc.js"></script>
    <script data-enc="common.js.enc.js"></script>
    <script data-enc="admin.js.enc.js"></script>
</body>
</html>
